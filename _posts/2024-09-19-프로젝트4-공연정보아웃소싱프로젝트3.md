---
title: "í”„ë¡œì íŠ¸4_ê³µì—°ì •ë³´_ì•„ì›ƒì†Œì‹± í”„ë¡œì íŠ¸1-3"
excerpt: "í”„ë¡œì íŠ¸ì§„í–‰"

categories:
  - Categories6
tags:
  - [tag1, tag2]

permalink: /categories6/teamproject4-3/

toc: true
toc_sticky: true

date: 2024-09-19
last_modified_at: 2024-09-19
---

## ğŸ¦¥ ë³¸ë¬¸

> ## ì¹´ì¹´ì˜¤ APIë¥¼ ì‚¬ìš©í•œ ì§€ë„ ì—°ê²°, zustandë¥¼ ì‚¬ìš©í•œ ì½”ë“œ tanstackQueryë¥¼ ì‚¬ìš©í•˜ì—¬ ë¦¬í™í† ë§
>
> ìƒì„¸í˜ì´ì§€ì˜ ì§€ë„ë¥¼ ì—°ê²°í•˜ê³ 
> ë§¨ ì²˜ìŒ zustandë¥¼ ì‚¬ìš©í•´ì„œ apië¥¼ ì—°ê²°í•˜ê³  ë°ì´í„°ë¥¼ ì €ì¥í–ˆë‹¤.
> tanstackQueryë¡œ ëŒ“ê¸€ ì‘ì„± ê¸°ëŠ¥ì„ ë§Œë“¤ê³  zustandë¡œ ë°ì´í„°ë¥¼ ì €ì¥í•  í•„ìš”ì—†ì´ tanstackQueryë¡œ ê´€ë¦¬í•˜ëŠ” ê²ƒì´ ë” ì¢‹ì„ ê²ƒ ê°™ë‹¤ëŠ” í”¼ë“œë°±ì„ ë°›ì•˜ë‹¤. ê¸°ëŠ¥ì„ ê°œë°œí•˜ê³  ë¦¬í™í† ë§í•˜ëŠ”ë° ë§ì€ ì—ëŸ¬ë“¤ì„ ê²ªê²Œ ë˜ì—ˆë‹¤...!

#### ìƒì„¸í˜ì´ì§€

![](https://velog.velcdn.com/images/alice0751/post/e8c4ee65-7844-4cdf-81c3-488d6d199c47/image.png)

#### ìƒì„¸í˜ì´ì§€ íƒ­ë¶€ë¶„

![](https://velog.velcdn.com/images/alice0751/post/cb1cf230-eea9-4ca9-ae3d-da1a7e90fd4c/image.png)

#### ìƒì„¸í˜ì´ì§€ ìœ„ì¹˜ ì§€ë„

![](https://velog.velcdn.com/images/alice0751/post/417c443a-14f5-4bd0-8ca0-f589085d88bb/image.png)

#### ë©”ì¸í˜ì´ì§€

![](https://velog.velcdn.com/images/alice0751/post/057383a2-d6f3-42ff-a869-c3cce7dfb70c/image.png)

#### ë©”ì¸í˜ì´ì§€

![](https://velog.velcdn.com/images/alice0751/post/43beb548-ff99-472b-acae-03f3543f8cda/image.png)

---

### zustandë¥¼ ì‚¬ìš©í•˜ì—¬ ê°œë°œí•œ ìƒì„¸í˜ì´ì§€

```js
// DetailPage.jsx
const { data, fetchData, error } = useKopisStore((state) => ({
  data: state.data,
  fetchData: state.fetchData,
  error: state.error,
}));
const { id } = useParams();

useEffect(() => {
  fetchData(id);
}, [fetchData, id]);

if (error) {
  return <div className="text-red-500">ì—ëŸ¬ ë°œìƒ: {error}</div>;
}

if (!data) {
  return <div className="text-gray-500">Loading...</div>;
}
```

```jsx
// DetailMap.jsx
import React, { useEffect, useRef } from "react";
import useKopisStore from "../../zustand/useKopisStore";

const DetailMap = () => {
  const mapRef = useRef(null);

  // ê³µì—° ì¥ì†Œ ê°€ì ¸ì˜¤ê¸°
  const { fetchMapData, mapData, data } = useKopisStore((state) => ({
    fetchMapData: state.fetchMapData,
    mapData: state.mapData,
    data: state.data,
  }));

  // ìƒì„¸í˜ì´ì§€ ì •ë³´ì—ì„œ ê³µì—°ì¥ì†Œid ë½‘ì•„ë‚´ê¸°
  const placeId = data?.mt10id; // dataê°€ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸

  // ê³µì—° ì¥ì†Œ ì²«í™”ë©´ì— ë¶ˆëŸ¬ì˜¤ê¸°
  useEffect(() => {
    if (placeId) {
      fetchMapData(placeId);
    }
  }, [fetchMapData, placeId]);

  useEffect(() => {
    if (
      window.kakao &&
      window.kakao.maps &&
      mapData?.la &&
      mapData?.lo // mapDataì™€ ì¢Œí‘œê°€ ìœ íš¨í•œì§€ í™•ì¸
    ) {
      const mapContainer = mapRef.current;
      const mapOption = {
        center: new window.kakao.maps.LatLng(mapData.la, mapData.lo), // ì§€ë„ì˜ ì¤‘ì‹¬ ì¢Œí‘œ
        level: 3, // ì§€ë„ì˜ í™•ëŒ€ ë ˆë²¨
      };

      // ì§€ë„ ìƒì„±
      const map = new window.kakao.maps.Map(mapContainer, mapOption);

      // ë§ˆì»¤ ìœ„ì¹˜ ì„¤ì •
      const markerPosition = new window.kakao.maps.LatLng(
        mapData.la,
        mapData.lo
      );

      // ë§ˆì»¤ ìƒì„±
      const marker = new window.kakao.maps.Marker({
        position: markerPosition,
      });

      // ë§ˆì»¤ë¥¼ ì§€ë„ì— í‘œì‹œ
      marker.setMap(map);

      // ì¸í¬ìœˆë„ìš° ì„¤ì •
      const infowindow = new window.kakao.maps.InfoWindow({
        content: '<div style="padding:5px;">ì—¬ê¸°ì— ìœ„ì¹˜</div>', // ì¸í¬ìœˆë„ìš° ë‚´ìš©
      });

      // ë§ˆì»¤ í´ë¦­ ì‹œ ì¸í¬ìœˆë„ìš° í‘œì‹œ
      window.kakao.maps.event.addListener(marker, "click", () => {
        infowindow.open(map, marker);
      });
    } else {
      console.error("Kakao maps SDK not loaded or mapData not available");
    }
  }, [mapData]); // mapDataê°€ ë³€ê²½ë  ë•Œë§ˆë‹¤ ì‹¤í–‰

  // mapDataê°€ null ë˜ëŠ” undefinedì¸ì§€ í™•ì¸í•˜ì—¬ ì •ë³´ê°€ ì—†ì„ ë•Œ ì²˜ë¦¬
  if (!mapData) {
    return (
      <div>
        <h4 className="font-extrabold text-3xl mb-8">ì¥ì†Œ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</h4>
      </div>
    );
  }

  return (
    <>
      <h4 className="font-extrabold text-3xl mb-8">ì¥ì†Œ</h4>
      {mapData.adres ? (
        <p className="mb-8">{mapData.adres}</p>
      ) : (
        <p>ì£¼ì†Œ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
      )}

      {mapData.telno ? (
        <div>
          <p className="font-extrabold text-3xl mb-8">ë¬¸ì˜</p>
          <p className="mb-8">{mapData.telno}</p>
        </div>
      ) : (
        <p>ë¬¸ì˜ì²˜ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
      )}

      <div ref={mapRef} style={{ width: "100%", height: "400px" }}>
        {/* ì§€ë„ í‘œì‹œ */}
      </div>
    </>
  );
};

export default DetailMap;
```

```jsx
// useKopisStore.js
import { create } from "zustand";
import { fetchDetailData, fetchMapData } from "../api/detailApi";

const useKopisStore = create((set, get) => ({
  data: null,
  mapData: null,
  error: null,

  // ê³µì—° ìƒì„¸ ì •ë³´ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
  fetchData: async (id) => {
    try {
      const result = await fetchDetailData(id);
      if (result && result.dbs && result.dbs.db) {
        set({ data: result.dbs.db, error: null });
      } else {
        set({ error: "No data found", data: null });
      }
    } catch (error) {
      set({ error: `Error fetching details: ${error.message}`, data: null });
    }
  },

  // ê³µì—°ì¥ì†Œ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ ìƒíƒœì— ì €ì¥
  fetchMapData: async (id) => {
    try {
      const result = await fetchMapData(id); // API í˜¸ì¶œ
      console.log(result);
      if (result && result.dbs && result.dbs.db) {
        set({ mapData: result.dbs.db, error: null }); // ìƒíƒœì— ì €ì¥
        console.log(get().mapData);
      } else {
        set({ error: "No map data found", mapData: null });
      }
    } catch (error) {
      set({
        error: `Error fetching map data: ${error.message}`,
        mapData: null,
      });
    }
  },
}));

export default useKopisStore;
```

```js
// detailApi.js
import axios from "axios";
import { parseXMLToJSON } from "../utils/utils";

const apiKey = import.meta.env.VITE_KOPIS_KEY;

// ê³µì—° ìƒì„¸ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
export const fetchDetailData = async (id) => {
  const url = `http://kopis.or.kr/openApi/restful/pblprfr/${id}?service=${apiKey}`;

  try {
    const response = await axios.get(url);
    const jsonData = parseXMLToJSON(response.data);
    console.log(jsonData); // ë³€í™˜ëœ JSON ë°ì´í„° ì½˜ì†” ì¶œë ¥
    return jsonData;
  } catch (error) {
    console.error("Error fetching performance details:", error);
    throw new Error("ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
  }
};

// ê³µì—° ì¥ì†Œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
export const fetchMapData = async (placeId) => {
  const mapUrl = `http://www.kopis.or.kr/openApi/restful/prfplc/${placeId}?service=${apiKey}`;

  try {
    const response = await axios.get(mapUrl);
    const jsonData = parseXMLToJSON(response.data);
    return jsonData;
  } catch (error) {
    console.error("Error fetching performance locations:", error);
    throw new Error("ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
  }
};

// ìƒì„¸í˜ì´ì§€ ëŒ“ê¸€ ì‘ì„± ê¸°ëŠ¥

const jsonUrl = "http://localhost:5000/comments";
const commentApi = axios.create({ baseURL: jsonUrl });

export const detailAddComment = async (newComment) => {
  const { data } = await commentApi.post("/", newComment);
  return data;
};

export const detailGetComment = async () => {
  const { data } = await commentApi.get("/");
  return data;
};
```

### ğŸ’¥ TroubleShooting

#### ğŸ”¥ ë¬¸ì œì 

ë§¨ ì²˜ìŒì—ëŠ” ìœ„ì™€ ê°™ì´ detailApi.jsì—ì„œ axiosë¥¼ ì‚¬ìš©í•´ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ê³  ì´ê²ƒì„ zustandì—ì„œ ì „ì—­ì—ì„œ ê´€ë¦¬í•  ìˆ˜ ìˆë„ë¡ ë°ì´í„°ë¥¼ ì €ì¥í•˜ì—¬ í•´ë‹¹ ë°ì´í„°ê°€ í•„ìš”í•œ í˜ì´ì§€ì—ì„œ useStoreë¡œ ë°ì´í„°ë¥¼ êº¼ë‚´ì¼ë‹¤. ì´ë ‡ê²Œ ì‚¬ìš©í–ˆì„ ë•Œ useEffect, useStateë¥¼ ì‚¬ìš©í•´ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ê³ , ë¡œë”©ì¤‘ì¼ ë•Œì™€ ì—ëŸ¬ê°€ ë‚¬ì„ ë•Œì˜ ìƒí™©ì„ ë³µì¡í•œ ì½”ë“œë¡œ ì§ì ‘ ì„¤ì •í•´ì£¼ì–´ì•¼ í–ˆë‹¤. íŠœí„°ë‹˜ê»˜ì„œ ì˜¤ëŠ˜ ì „ì²´ì ì¸ ì½”ë“œë¥¼ ë´ì£¼ì…¨ëŠ”ë° tanstackQueryë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì§€ê¸ˆ zustandë¥¼ ì‚¬ìš©í•˜ì—¬ ë³µì¡í•œ ë¡œì§ì„ ì‚¬ìš©í•´ ë°ì´í„°ë¥¼ ê´€ë¦¬í•˜ëŠ” ê²ƒë³´ë‹¤ tanstackQueryë¥¼ ì‚¬ìš©í•˜ì—¬ ë¦¬í™í† ë§ í•˜ëŠ” ê²ƒì„ ì¶”ì²œí•´ì£¼ì…¨ë‹¤.

#### ğŸŒŸ í•´ê²°ë°©ë²•

apië¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë¡œì§ì€ detailApi.jsì—ì„œ ì‚¬ìš©í•˜ê³  ë°ì´í„° ì €ì¥ê´€ë¦¬ë§Œ useKopisStore.jsì—ì„œ ê´€ë¦¬í•˜ê³  ìˆì—ˆê¸° ë•Œë¬¸ì— useQueryë¡œ zustandë¥¼ ëŒ€ì²´í•´ì£¼ì—ˆë‹¤. ì´ë¯¸ ìƒì„¸í˜ì´ì§€ì—ì„œ ëŒ“ê¸€ì„ tanstackQueryë¡œ ê´€ë¦¬í•˜ë©°
main.jsì— ì•„ë˜ providerê°€ ë¡œë“œë˜ì–´ìˆì–´ useQueryë¬¸ë§Œ ì‘ì„±í•´ì£¼ì—ˆë‹¤.

```js
// main.jsx
import { StrictMode } from "react";
import { createRoot } from "react-dom/client";
import App from "./App.jsx";
import "./index.css";
import "the-new-css-reset/css/reset.css";
import { QueryClient, QueryClientProvider } from "@tanstack/react-query";

const queryClient = new QueryClient();

createRoot(document.getElementById("root")).render(
  <QueryClientProvider client={queryClient}>
    <StrictMode>
      <App />
    </StrictMode>
  </QueryClientProvider>
);
```

useParamsë¥¼ ì´ìš©í•´ idë¥¼ ê°€ì ¸ì™€ apiì— idë¥¼ ë„£ì–´ì£¼ëŠ” ê²ƒì€ ë™ì¼í•˜ê¸° ë•Œë¬¸ì— ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ì˜€ê³  queryKeyì™€ queryFnì„ ì§€ì •í•´ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™”ë‹¤.

```js
const { id } = useParams();

// ê³µì—° ìƒì„¸ ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸°
const {
  data,
  isLoading: detailLoading,
  isError: detailError,
} = useQuery({
  queryKey: ["performanceDetail", id],
  queryFn: () => fetchDetailData(id),
});
const detailData = data?.dbs?.db;

if (detailLoading) {
  return <div>Loading...</div>;
}
if (detailError) {
  return <div>Error</div>;
}
```

ê·¸ë¦¬ê³  ì´ë¯¸ queryì— ë‚´ì¥ë˜ì–´ìˆëŠ” isLoadingê³¼ isErrorë¥¼ ì§€ì •í•´ ë¡œë”©ì¤‘ì¼ ë•Œì™€ ì—ëŸ¬ê°€ ë‚¬ì„ ë•Œ ì²˜ë¦¬ë  ìˆ˜ ìˆë„ë¡ ë¡œì§ì„ ì‘ì„±í•´ì£¼ì—ˆë‹¤.

---

## ğŸ’¥ íŠ¸ëŸ¬ë¸” ìŠˆíŒ… 2 : ì¹´ì¹´ì˜¤apië¥¼ ì‚¬ìš©í•œ ì§€ë„ í‘œì‹œí•˜ê¸° & zustandì—ì„œ tanstackQueryë¡œ ì½”ë“œ ë¦¬í™í† ë§

#### ğŸ”¥ ë¬¸ì œì 

ì¹´ì¹´ì˜¤ apië¥¼ ì‚¬ìš©í•´ ì§€ë„ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ê²½í—˜ì´ ì²˜ìŒì´ë¼ ì—°ê²°í•˜ëŠ”ë° ê½¤ ë§ì€ ì‹œê°„ì´ ê±¸ë ¸ë‹¤. scriptë¥¼ ì¶”ê°€í•  ë•Œ ë°”ë¡œ api keyë¥¼ ì§‘ì–´ë„£ìœ¼ë©´ í¸í–ˆê² ì§€ë§Œ .envì— keyë¥¼ ì €ì¥í•˜ê³  ë¶ˆëŸ¬ì™€ ë³´ì•ˆì„±ì„ ê°•í™”í•˜ë ¤ê³  ë…¸ë ¥í–ˆë‹¤.

#### âœ¨ í•´ê²°ë°©ë²•

ë¨¼ì € .envì— ë‚´ api keyë¥¼ ì €ì¥í•´ì£¼ì—ˆë‹¤. ë‚˜ëŠ” viteë¡œ reactë¥¼ ë§Œë“¤ì–´ì£¼ì—ˆê¸° ë•Œë¬¸ì— VITE_KAKAOMAP_KEY = ~~~~~~ ë¡œ ì§€ì •í•´ì£¼ì—ˆë‹¤.
ê·¸ë¦¬ê³  index.htmlì—ì„œ scriptë¥¼ ì§€ì •í•´ì£¼ì—ˆë‹¤.

```js
// DetailMap.jsx
<script
  type="text/javascript"
  src="//dapi.kakao.com/v2/maps/sdk.js?appkey=%VITE_KAKAOMAP_KEY%&libraries=services,clusterer"
></script>
```

ë§¨ ì²˜ìŒì—ëŠ” ì¹´ì¹´ì˜¤api docsì— ë‚˜ì™€ìˆëŠ” ë°©ë²•ìœ¼ë¡œ ì§€ë„ë¥¼ ë¶ˆëŸ¬ì™”ë‹¤.
kopis ê³µì—°ì¥ì†Œ apië¥¼ ë¶ˆëŸ¬ì˜¤ê³  ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ê²ƒë„ zustandë¡œ ì§„í–‰í•˜ì—¬ ì•„ë˜ì™€ ê°™ì€ ë¡œì§ì„ ì‘ì„±í–ˆì—ˆë‹¤.

```js
import React, { useEffect, useRef } from "react";
import useKopisStore from "../../zustand/useKopisStore";

const DetailMap = () => {
  const mapRef = useRef(null);

  // ê³µì—° ì¥ì†Œ ê°€ì ¸ì˜¤ê¸°
  const { fetchMapData, mapData, data } = useKopisStore((state) => ({
    fetchMapData: state.fetchMapData,
    mapData: state.mapData,
    data: state.data,
  }));

  // ìƒì„¸í˜ì´ì§€ ì •ë³´ì—ì„œ ê³µì—°ì¥ì†Œid ë½‘ì•„ë‚´ê¸°
  const placeId = data?.mt10id; // dataê°€ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸

  // ê³µì—° ì¥ì†Œ ì²«í™”ë©´ì— ë¶ˆëŸ¬ì˜¤ê¸°
  useEffect(() => {
    if (placeId) {
      fetchMapData(placeId);
    }
  }, [fetchMapData, placeId]);

  useEffect(() => {
    if (
      window.kakao &&
      window.kakao.maps &&
      mapData?.la &&
      mapData?.lo // mapDataì™€ ì¢Œí‘œê°€ ìœ íš¨í•œì§€ í™•ì¸
    ) {
      const mapContainer = mapRef.current;
      const mapOption = {
        center: new window.kakao.maps.LatLng(mapData.la, mapData.lo), // ì§€ë„ì˜ ì¤‘ì‹¬ ì¢Œí‘œ
        level: 3, // ì§€ë„ì˜ í™•ëŒ€ ë ˆë²¨
      };

      // ì§€ë„ ìƒì„±
      const map = new window.kakao.maps.Map(mapContainer, mapOption);

      // ë§ˆì»¤ ìœ„ì¹˜ ì„¤ì •
      const markerPosition = new window.kakao.maps.LatLng(
        mapData.la,
        mapData.lo
      );

      // ë§ˆì»¤ ìƒì„±
      const marker = new window.kakao.maps.Marker({
        position: markerPosition,
      });

      // ë§ˆì»¤ë¥¼ ì§€ë„ì— í‘œì‹œ
      marker.setMap(map);

      // ì¸í¬ìœˆë„ìš° ì„¤ì •
      const infowindow = new window.kakao.maps.InfoWindow({
        content: '<div style="padding:5px;">ì—¬ê¸°ì— ìœ„ì¹˜</div>', // ì¸í¬ìœˆë„ìš° ë‚´ìš©
      });

      // ë§ˆì»¤ í´ë¦­ ì‹œ ì¸í¬ìœˆë„ìš° í‘œì‹œ
      window.kakao.maps.event.addListener(marker, "click", () => {
        infowindow.open(map, marker);
      });
    } else {
      console.error("Kakao maps SDK not loaded or mapData not available");
    }
  }, [mapData]); // mapDataê°€ ë³€ê²½ë  ë•Œë§ˆë‹¤ ì‹¤í–‰

  // mapDataê°€ null ë˜ëŠ” undefinedì¸ì§€ í™•ì¸í•˜ì—¬ ì •ë³´ê°€ ì—†ì„ ë•Œ ì²˜ë¦¬
  if (!mapData) {
    return (
      <div>
        <h4 className="font-extrabold text-3xl mb-8">ì¥ì†Œ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</h4>
      </div>
    );
  }

  return (
    <>
      <h4 className="font-extrabold text-3xl mb-8">ì¥ì†Œ</h4>
      {mapData.adres ? (
        <p className="mb-8">{mapData.adres}</p>
      ) : (
        <p>ì£¼ì†Œ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
      )}

      {mapData.telno ? (
        <div>
          <p className="font-extrabold text-3xl mb-8">ë¬¸ì˜</p>
          <p className="mb-8">{mapData.telno}</p>
        </div>
      ) : (
        <p>ë¬¸ì˜ì²˜ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
      )}

      <div ref={mapRef} style={{ width: "100%", height: "400px" }}>
        {/* ì§€ë„ í‘œì‹œ */}
      </div>
    </>
  );
};

export default DetailMap;
```

```jsx
// useKopisStore.js
  // ê³µì—°ì¥ì†Œ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ ìƒíƒœì— ì €ì¥
  fetchMapData: async (id) => {
    try {
      const result = await fetchMapData(id); // API í˜¸ì¶œ
      console.log(result);
      if (result && result.dbs && result.dbs.db) {
        set({ mapData: result.dbs.db, error: null }); // ìƒíƒœì— ì €ì¥
        console.log(get().mapData);
      } else {
        set({ error: "No map data found", mapData: null });
      }
    } catch (error) {
      set({
        error: `Error fetching map data: ${error.message}`,
        mapData: null,
      });
    }
  },
}));


```

```js
// detailApi.js
export const fetchMapData = async (placeId) => {
  const mapUrl = `http://www.kopis.or.kr/openApi/restful/prfplc/${placeId}?service=${apiKey}`;

  try {
    const response = await axios.get(mapUrl);
    const jsonData = parseXMLToJSON(response.data);
    return jsonData;
  } catch (error) {
    console.error("Map Error", error);
    throw new Error("ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
  }
};
```

### ì¹´ì¹´ì˜¤ map api ì½”ë“œ ë¦¬í™í† ë§

: apië¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë¶€ë¶„ì€ ê·¸ëŒ€ë¡œ ë‚¨ê²¨ë‘ê³  ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ë¶€ë¶„ì„ tanstackQueryë¡œ ë³€ê²½ì‹œì¼œì£¼ì—ˆë‹¤. map ì»´í¬ë„ŒíŠ¸ ë˜í•œ detailPageì•ˆì— ìˆëŠ” ë¶€ë¶„ì´ê¸° ë•Œë¬¸ì— propsë¡œ ìƒì„¸í˜ì´ì§€ apië°ì´í„°ì •ë³´ì— ìˆëŠ” ì¥ì†Œ ì•„ì´ë””ë¥¼ ë°›ê¸°ìœ„í•´ detailDataë¥¼ ë‚´ë ¤ë°›ì•˜ë‹¤.
ë˜‘ê°™ì´ ì§€ë„ ì •ë³´ë¥¼ ì €ì¥í•´ì£¼ê³  ì½”ë“œì˜ ê°€ë…ì„±ê³¼ ë‹¤ì–‘í•œ ì§€ë„ ì‚¬ìš©ì„ ìœ„í•´ ì¹´ì¹´ì˜¤ ì§€ë„ sdkë¥¼ í™œìš©í•˜ì—¬ ì½”ë“œë¥¼ ë¦¬í™í† ë§í•´ì£¼ì—ˆë‹¤.

```jsx
import React from "react";
import { useQuery } from "@tanstack/react-query";
import { Map, MapMarker, ZoomControl } from "react-kakao-maps-sdk";
import { fetchMapData } from "../../api/detailApi";

const DetailMap = ({ detailData }) => {
  const placeId = detailData?.mt10id;
  const { data, isLoading, isError } = useQuery({
    queryKey: ["mapData", placeId],
    queryFn: () => fetchMapData(placeId),
    enabled: !!placeId,
  });

  const mapData = data?.dbs?.db;

  if (isLoading) {
    return <div>Loading...</div>;
  }

  if (isError) {
    return <div>Error</div>;
  }

  if (!mapData) {
    return <div>ì¥ì†Œ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</div>;
  }

  // ì¢Œí‘œê°’ì„ ìˆ«ìë¡œ ë³€í™˜
  const lat = parseFloat(mapData.la);
  const lng = parseFloat(mapData.lo);

  return (
    <div>
      <h4 className="font-extrabold text-3xl mb-8">ì¥ì†Œ</h4>
      <p className="mb-8">{mapData.adres || "ì£¼ì†Œ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤."}</p>
      {mapData.telno && (
        <div>
          <h4 className="font-extrabold text-3xl mb-8">ë¬¸ì˜</h4>
          <p className="mb-8">{mapData.telno}</p>
        </div>
      )}
      {!mapData.telno && <p>ë¬¸ì˜ì²˜ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>}

      <Map
        center={{ lat, lng }} // ì¢Œí‘œê°’ì„ ìˆ«ìë¡œ ë³€í™˜í•˜ì—¬ ì„¤ì •
        style={{ width: "100%", height: "500px" }}
        level={3}
      >
        <MapMarker position={{ lat, lng }} />
        <ZoomControl />
      </Map>
    </div>
  );
};

export default DetailMap;
```

---

## ëŒ“ê¸€ ê¸°ëŠ¥ ê°œë°œ (ì—…ë¡œë“œ, ì‚­ì œ)

ë¨¼ì € detailApi.jsì—ì„œ json-serverì™€ ì—°ê²°ë  ìˆ˜ ìˆë„ë¡ axioë¥¼ ì‚¬ìš©í•˜ì—¬ ëŒ“ê¸€ì„ ë¶ˆëŸ¬ì˜¤ê³  ì¶”ê°€í•˜ê³  ì‚­ì œí•˜ëŠ” ë¡œì§ì„ ì‘ì„±í•´ì£¼ì—ˆë‹¤.

```js
// ìƒì„¸í˜ì´ì§€ ëŒ“ê¸€ ì‘ì„± ê¸°ëŠ¥

const jsonUrl = "http://localhost:5000/comments";
const commentApi = axios.create({ baseURL: jsonUrl });

// ëŒ“ê¸€ ì¶”ê°€
export const detailAddComment = async (newComment) => {
  const { data } = await commentApi.post("/", newComment);
  return data;
};

// íŠ¹ì • ê³µì—°ì˜ ëŒ“ê¸€ ê°€ì ¸ì˜¤ê¸°
export const detailGetComment = async (performanceId) => {
  const { data } = await commentApi.get("/");
  return data.filter((comment) => comment.performanceId === performanceId);
};

// ëŒ“ê¸€ ì‚­ì œ
export const detailDeleteComment = async (id) => {
  const { data } = await commentApi.delete(`/${id}`);
  return data;
};
```

db.json

```js
"comments": [
    {
      "id": "d160",
      "email": "58d6b8a8-eddc-4088-a757-07c4022e854e",
      "content": "í˜¸ì´í˜¸ì´",
      "performanceId": "PF248202"
    },
  ]
```

DetailComments.jsx

```js
import React, { useState } from "react";
import { useQuery, useQueryClient, useMutation } from "@tanstack/react-query";
import useUserStore from "../../zustand/useUserStore";
import { v4 as uuidv4 } from "uuid";
import {
  detailAddComment,
  detailDeleteComment,
  detailGetComment,
} from "../../api/detailApi";

const DetailComments = ({ id }) => {
  const [comment, setComment] = useState("");
  const queryClient = useQueryClient();
  const { user } = useUserStore();

  // ëŒ“ê¸€ ì¶”ê°€ mutation
  const addMutation = useMutation({
    mutationFn: (newComment) =>
      detailAddComment({ ...newComment, performanceId: id }),
    onSuccess: () => {
      queryClient.invalidateQueries(["comments", id]);
      setComment("");
    },
  });

  // ëŒ“ê¸€ ì‚­ì œ mutation
  const removeMutation = useMutation({
    mutationFn: detailDeleteComment,
    onSuccess: () => {
      queryClient.invalidateQueries(["comments", id]);
    },
  });

  // ëŒ“ê¸€ ê°€ì ¸ì˜¤ê¸° query
  const {
    data: comments = [], // ê¸°ë³¸ê°’ì„ ë¹ˆ ë°°ì—´ë¡œ ì„¤ì •
    isLoading,
    isError,
  } = useQuery({
    queryKey: ["comments", id],
    queryFn: () => detailGetComment(id),
  });

  if (isLoading) {
    return <p>ë¡œë”©ì¤‘ì…ë‹ˆë‹¤.</p>;
  }

  if (isError) {
    return <p>ëŒ“ê¸€ì„ ê°€ì ¸ì˜¤ë˜ ì¤‘ ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>;
  }

  const handleSubmit = (e) => {
    e.preventDefault();
    if (comment.trim()) {
      addMutation.mutate({
        email: user?.email || uuidv4(), // ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ì´ë©”ì¼ ì‚¬ìš© ë˜ëŠ” ìœ ë‹ˆí¬ ID
        content: comment,
      });
    }
  };

  const handleDelete = (id) => {
    removeMutation.mutate(id);
  };

  return (
    <>
      <div>
        <h4 className="font-extrabold text-3xl mb-8">íšŒì›ë¦¬ë·°</h4>
        {comments.length > 0 ? (
          comments.map((comment) => (
            <div
              className="w-[750px] bg-slate-200 rounded mx-auto pb-4 mb-8 relative"
              key={comment.id}
            >
              <p className="font-bold text-left pl-4 mb-4">{comment.email}</p>
              <p>{comment.content}</p>
              <button
                onClick={() => handleDelete(comment.id)}
                className="cursor-pointer w-[50px] h-[30px] bg-accent rounded absolute bottom-2 right-2 "
              >
                ì‚­ì œ
              </button>
            </div>
          ))
        ) : (
          <p>ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
        )}
      </div>
      <form onSubmit={handleSubmit} className="mt-20">
        <h4 className="font-extrabold text-3xl mb-8">í•œì¤„í‰</h4>
        <input
          type="text"
          onChange={(e) => setComment(e.target.value)}
          value={comment}
          placeholder="ë¦¬ë·°ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”"
          className="w-[700px] h-[100px] bg-slate-200 rounded"
        />
        <button
          type="submit"
          className="cursor-pointer w-[50px] h-[100px] bg-primary rounded text-white"
        >
          ë“±ë¡
        </button>
      </form>
    </>
  );
};

export default DetailComments;
```

tanstackQueryì˜ mutation, mutate, queryClient.invalidateQueriesë¥¼ í™œìš©í•´ ì¶”ê°€ë˜ê³  ì‚­ì œëœ ë°ì´í„°ë“¤ì´ ë°”ë¡œ ë°˜ì˜ë  ìˆ˜ ìˆë„ë¡ ë¡œì§ì„ ì‘ì„±í•´ì£¼ì—ˆë‹¤.
userë¶€ë¶„ì´ ì•„ì§ ê°œë°œì´ ëœ ëœ ìƒíƒœë¼ì„œ ë¡œê·¸ì¸í–ˆì„ ë•Œì—ë§Œ ëŒ“ê¸€ì„ ì‘ì„±í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ë¶€ë¶„ì€ ì•„ì§ ì‘ì„±í•˜ì§€ ì•Šì•˜ë‹¤.
mutationFnê³¼, onSuccessë¥¼ í™œìš©í•˜ì—¬ ëŒ“ê¸€ì´ ì¶”ê°€ë˜ê³  ë‚˜ì„œ ì„±ê³µí•  ì‹œ ë°”ë¡œ ë°˜ì˜ë  ìˆ˜ ìˆê²Œ queryClient.invalidateQueriesë¡œ ì„¤ì •í•´ì£¼ì—ˆë‹¤.

---

### ğŸ§šâ€â™€ï¸ ëŠë‚€ì 

ë§¨ ì²˜ìŒì— tailwindCssë„ tanstackQueryë„ context, useState, useEffect, zustand redux...ê¹Œì§€ ë‹¤ì–‘í•˜ê³  ë§ì€ í›…ë“¤ì— ì“°ì„ìƒˆì™€ ìš©ë„ê°€ ë§ì´ í˜¼ë€ìŠ¤ëŸ½ê³  ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì‰½ì§€ ì•Šì•˜ë‹¤. ì‹¤ìŠµì„ ê³„ì†í•´ì„œ ì§„í–‰í•˜ê³  íŒ€ì›ë“¤ê³¼ ì†Œí†µí•˜ë©° ë‚´ ì½”ë“œë¥¼ í•¨ê»˜ ì´ì•¼ê¸°í•˜ëŠ” ê³¼ì •ì—ì„œ ë§ì´ ë°œì „ì„ í•˜ê³  ìˆìŒì„ ëŠë¼ê³  ìˆëŠ” ê²ƒ ê°™ë‹¤. ë˜í•œ 404ì—ëŸ¬ê°™ì€ ì—ëŸ¬ë„ ê²ªê³  CORSì—ëŸ¬ë„ ê²ªìœ¼ë©´ì„œ ë§ì€ ë‚œí•­ë“¤ì„ ê²ªê³  ìˆëŠ”ë° í•˜ë‚˜í•˜ë‚˜ í•´ê²°í•  ë•Œë§ˆë‹¤ ì¡°ê¸ˆì”© ì„±ì¥í•´ê°€ê³  ìˆìŒì„ ëŠë‚€ë‹¤. ì•ìœ¼ë¡œë„ ë§ì€ ì˜¤ë¥˜ë“¤ì´ ë‚˜ë¥¼ ê¸°ë‹¤ë¦¬ê³  ìˆê² ì§€ë§Œ ê·¸ëŸ¼ì—ë„ í˜ì„ ë‚´ì„œ ì—´ì‹¬íˆ í•´ê²°í•´ë³´ë ¤ê³  í•œë‹¤.....!
