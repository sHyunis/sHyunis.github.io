---
title: "Next jsì˜ Asset ìµœì í™”, Route Handler(ë²¡ì—”ë“œ êµ¬í˜„ê°€ëŠ¥) & Server Action, Next.js ìºì‹±(Caching)"
excerpt: "SETUP"

categories:
  - Categories9
tags:
  - [tag1, tag2]

permalink: /categories9/Next.js ìˆ™ë ¨/

toc: true
toc_sticky: true

date: 2024-09-27
last_modified_at: 2024-09-27
---

### â˜˜ï¸ Next jsì˜ Asset ìµœì í™”, Route Handler(ë²¡ì—”ë“œ êµ¬í˜„ê°€ëŠ¥) & Server Action, #\Next.js ìºì‹±(Caching)

# ğŸŒŸ Next jsì˜ Asset ìµœì í™”, Route Handler(ë²¡ì—”ë“œ êµ¬í˜„ê°€ëŠ¥) & Server Action, #\Next.js ìºì‹±(Caching)

## â˜˜ï¸ Next jsì˜ Asset ìµœì í™”

1. Next/Imageë¥¼ ì´ìš©í•œ ì´ë¯¸ì§€ ìµœì í™”

- ì´ë¯¸ì§€ëŠ” ì¼ë°˜ì ì¸ ì›¹ì‚¬ì´íŠ¸ í˜ì´ì§€ ë¬´ê²Œì˜ ì•„ì£¼ í° ë¶€ë¶„ì„ ì°¨ì§€í•˜ë©°, ì›¹ì‚¬ì´íŠ¸ì˜ LCP(Largest Contentful Paint) ì„±ëŠ¥ì— í° ì˜í–¥ì„ ë¯¸ì¹œë‹¤.

> ìë™ ì´ë¯¸ì§€ ìµœì í™” ê¸°ëŠ¥

- í¬ê¸°ìµœì í™” : ê° ê¸°ê¸°ì— ë§ëŠ” í¬ê¸°ì˜ ì´ë¯¸ì§€ë¥¼ ìë™ìœ¼ë¡œ ì œê³µ
- ë¡œì»¬ ì´ë¯¸ì§€ ì„¤ì •

```js
import { Product } from "@/type/product";
import Image from "next/image";

const NewProductList = async () => {
  const res = await fetch("http://localhost:4000/products", {
    cache: "no-store",
  });
  const data: Product[] = await res.json();
  const newData = data.filter((p) => p.isNew);

  return (
    <div className="flex gap-2 oveflow-auto w-full">
      <div className="w-max flex gap-2">
        {newData.map((product) => (
          <div
            className="flex gap-2 w-[250px] border rounded-sm"
            key={product.id}
          >
            <Image
              className="rounded-sm object-scale-down"
              width={80}
              height={80}
              src={product.images}
              alt={product.title}
            />
            <div className="flex flex-col justify-between">
              <div>
                <h2 className="text-md font-medium">{product.title}</h2>
                <p className="mt-4 font-thin">{product.price.amount}$</p>
              </div>
            </div>
          </div>
        ))}
      </div>
    </div>
  );
};

export default NewProductList;
```

- ì›ê²©ì´ë¯¸ì§€ ì„¤ì •

```js
import Image from "next/image";

export default function Page() {
  return (
    <Image
      src="<network-image>"
      alt="Picture of the author"
      width={500}
      height={500}
    />
  );
}
```

- ì›ê²© ì´ë¯¸ì§€ ì‚¬ìš©ì„ ìœ„í•œ ì¶”ê°€ ì„¤ì •
  next.config.js

```js
/** @type {import('next').NextConfig} */
const nextConfig = {
  reactStrictMode: false,
  images: {
    remotePatterns: [
      {
        protocol: "https",
        hostname: "fakestoreapi.com",
        pathname: "/**",
      },
    ],
    formats: ["image/avif", "image/webp"],
  },
};
```

- AVIF,WebPì¶”ê°€

---

## Metadataë¥¼ í†µí•œ SEOìµœì í™”

Next.jsê°€ ì œê³µí•˜ëŠ” ë©”íƒ€ ë°ì´í„°ë¥¼ ì •ì˜í•˜ê¸° ìœ„í•œ ë‘ ê°€ì§€ ë°©ë²•

1. Config ê¸°ë°˜ ë©”íƒ€ë°ì´í„° : layout.jsë˜ëŠ” page.jsíŒŒì¼ì—ì„œ ì •ì  ë©”íƒ€ë°ì´í„° ê°ì²´ ë˜ëŠ” ë™ì  generateMetadataí•¨ìˆ˜ë¥¼ ë‚´ë³´ë‚¸ë‹¤.
2. íŒŒì¼ ê¸°ë°˜ ë©”íƒ€ë°ì´í„° : ë¼ìš°íŠ¸ ì„¸ê·¸ë¨¼íŠ¸ì— ì •ì  ë˜ëŠ” ë™ì ìœ¼ë¡œ ìƒì„±ëœ íŠ¹ë³„í•œ íŒŒì¼ì„ ì¶”ê°€í•œë‹¤. ë‘ ì˜µì…˜ ëª¨ë‘ì—ì„œ Next.jsëŠ” í˜ì´ì§€ì— ëŒ€í•œ ê´€ë ¨ headìš”ì†Œë¥¼ ìë™ìœ¼ë¡œ ìƒì„±í•œë‹¤.

3. ì •ì  ë©”íƒ€ë°ì´í„°

- ì •ì  ë©”íƒ€ë°ì´í„° ì •ì˜ì‹œ layout.jsë˜ëŠ” page.jsíŒŒì¼ì—ì„œ Metadataê°ì²´ë¥¼ ë‚´ë³´ë‚¸ë‹¤.

```js
// layout.tsx | page.tsx
import type { Metadata } from "next";

export const metadata: Metadata = {
  title: "...",
  description: "...",
};

export default function Page() {}
```

2. ë™ì  ë©”íƒ€ë°ì´í„°

- ë™ì  ê°’ì´ í•„ìš”í•œ ë©”íƒ€ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ë ¤ë©´ generateMetadataí•¨ìˆ˜ë¥¼ ì‚¬ìš©ê°€ëŠ¥

```js
// app/products/[id]/page.tsx
import type { Metadata, ResolvingMetadata } from 'next'

type Props = {
  params: { id: string }
  searchParams: { [key: string]: string | string[] | undefined }
}

export async function generateMetadata(
  { params, searchParams }: Props,
): Promise<Metadata> {
  // ê²½ë¡œ ë§¤ê°œë³€ìˆ˜ ì½ê¸°
  const id = params.id

  // ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
  const product = await fetch(`https://.../${id}`).then((res) => res.json())

  return {
    title: product.title,
  }
}

export default function Page({ params, searchParams }: Props) {}
```

#### íŒŒì¼ ê¸°ë°˜ ë©”íƒ€ ë°ì´í„°

- `favicon.ico`, `apple-icon.jpg`, `icon.jpg`
- `opengraph-image.jpg` ë° `twitter-image.jpg`
- `robots.txt`
- `sitemap.xml`

#### â˜˜ï¸ ë°ì´í„° ì ìš©

Next.jsì—ì„œëŠ” `public` í´ë”ë¥¼ ì‚¬ìš©í•˜ì—¬ ì •ì  íŒŒì¼ì„ ì‰½ê²Œ ì œê³µí•  ìˆ˜ ìˆë‹¤. `public` í´ë” ë‚´ì˜ íŒŒì¼ì€ ê¸°ë³¸ URL(`/`)ì„ ê¸°ì¤€ìœ¼ë¡œ ì°¸ì¡°í•  ìˆ˜ ìˆë‹¤.

ex1) Logo.png

```js
import Image from "next/image";
import Logo from "/public/assets/logo.png";

<Image height={40} src={Logo} alt="logo"></Image>;
```

#### â˜˜ï¸ Font Optimization

- `next/font`ë¥¼ ì‚¬ìš©í•˜ë©´ í°íŠ¸ë¥¼ ìë™ìœ¼ë¡œ ìµœì í™”í•˜ê³  ì™¸ë¶€ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì„ ì œê±°í•˜ì—¬ ê°œì¸ì •ë³´ ë³´í˜¸ì™€ ì„±ëŠ¥ì„ í–¥ìƒì‹œí‚¬ ìˆ˜ ìˆìŒ
- next/fontëŠ” ëª¨ë“  í°íŠ¸ íŒŒì¼ì— ëŒ€í•´ ìë™ìœ¼ë¡œ ì…€í”„ í˜¸ìŠ¤íŒ…ì„ ì œê³µí•©ë‹ˆë‹¤. ë ˆì´ì•„ì›ƒ ì‹œí”„íŒ…(Layout Shifting) ì—†ì´ ìµœì ì˜ ë°©ì‹ìœ¼ë¡œ ì›¹ í°íŠ¸ë¥¼ ë¡œë“œí•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì¤Œ

### - Google Fonts

next/font/googleì—ì„œ ì‚¬ìš©í•  í°íŠ¸ë¥¼ ê°€ì ¸ì™€ í•¨ìˆ˜ë¡œ ì‚¬ìš©

```js
import { Inter } from "next/font/google";

const inter = Inter({
  subsets: ["latin"],
  display: "swap",
});

export default function RootLayout({ children }) {
  return (
    <html lang="en" className={inter.className}>
      <body>{children}</body>
    </html>
  );
}
```

### - Multiple Fonts ì‚¬ìš©

- ì—¬ëŸ¬ í°íŠ¸ë¥¼ ì‚¬ìš©í•´ì•¼ í•  ë•ŒëŠ” í°íŠ¸ë¥¼ ë‚´ë³´ë‚´ê³  í•„ìš”í•œ ê³³ì—ì„œ ê°€ì ¸ì™€ì„œ ì‚¬ìš©

```js
import { Inter, Roboto_Mono } from "next/font/google";

export const inter = Inter({
  subsets: ["latin"],
  display: "swap",
});

export const roboto_mono = Roboto_Mono({
  subsets: ["latin"],
  display: "swap",
});

import { inter } from "./fonts";

export default function Layout({ children }) {
  return (
    <html lang="en" className={inter.className}>
      <body>
        <div>{children}</div>
      </body>
    </html>
  );
}
```

### - Local Fontsì‚¬ìš©

```js
import localFont from "next/font/local";

// Font files can be colocated inside of `app`
const myFont = localFont({
  src: "./my-font.woff2",
  display: "swap",
});

export default function RootLayout({
  children,
}: {
  children: React.ReactNode,
}) {
  return (
    <html lang="en" className={myFont.className}>
      <body>{children}</body>
    </html>
  );
}
```

### - Scriptì‚¬ìš©

- next/scriptë¥¼ ì‚¬ìš©í•˜ì—¬ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ìµœì í™”í•  ìˆ˜ ìˆë‹¤.

ì‚¬ìš©ë²•

```js
import Script from "next/script";

export default function RootLayout({ children }) {
  return (
    <html lang="en">
      <body>{children}</body>
      <Script src="https://example.com/script.js" />
    </html>
  );
}
```

ìŠ¤í¬ë¦½íŠ¸ ë¡œë”© ì „ëµì„ ì„¸ë¶€ì ìœ¼ë¡œ ì¡°ì •í•  ìˆ˜ ìˆë‹¤:

- `beforeInteractive`: Next.js ì½”ë“œ ë° í˜ì´ì§€ í•˜ì´ë“œë ˆì´ì…˜ ì „ì— ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ
- `afterInteractive`: (ê¸°ë³¸ê°’) í˜ì´ì§€ í•˜ì´ë“œë ˆì´ì…˜ í›„ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ
- `lazyOnload`: ë¸Œë¼ìš°ì € ìœ íœ´ ì‹œê°„ì— ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ
- `worker`: (ì‹¤í—˜ì ) ì›¹ ì›Œì»¤ì—ì„œ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ

---

## ğŸŒŸ Route Handler(ë²¡ì—”ë“œ êµ¬í˜„ê°€ëŠ¥) & Server Action

### 1. Router handler

api>apiTestë¥¼ ë§Œë“  í›„ í•˜ìœ„ì— route.tsíŒŒì¼ ìƒì„±

```js
export async function GET(request: Request) {
  console.log("GET /api/test");
}

export async function POST(request: Request) {
  console.log("POST /api/test");
}

export async function PUT(request: Request) {
  console.log("PUT /api/test");
}

export async function DELETE(request: Request) {
  console.log("DELETE /api/test");
}

export async function PATCH(request: Request) {
  console.log("PATCH /api/test");
}
```

Thunder Clientë¡œ í…ŒìŠ¤íŠ¸
POST / http://localhost:3000/api/test

### 2. Server Action

- ì„œë²„ì—ì„œ ì‹¤í–‰ë˜ëŠ” ë¹„ë™ê¸° í•¨ìˆ˜, í¼ ì œì¶œê³¼ ê°™ì€ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆê²Œ í•¨
- ì‚¬ìš©ì‹œ "use server"ì§€ì‹œì–´ ì‚¬ìš©
- ì£¼ë¡œ CRUDì‘ì—…ìˆ˜í–‰í•˜ëŠ”ë° ì‚¬ìš©

```js
"use server";
import { Product } from "@/type/product";
import { BASE_URL } from "@/constants/api";

export async function getProducts() {
  const res = await fetch(`${BASE_URL}/products`, {
    cache: "no-store",
  });
  const data: Product[] = await res.json();

  return { data };
}
```

ex) cartê°™ì€ ê³³ ê°’ ë„£ì„ ë•Œ

```js
'use server';

import { revalidatePath } from 'next/cache';
import { redirect } from 'next/navigation';

export async function addItemToCart(formData: FormData) {
  const { itemId, quantity } = formData.get('itemId'), formData.get('quantity');
  const cart = await fetch({...});

  revalidatePath('/cart');
  redirect('/cart');
}
```

---

# Next.js ìºì‹±(Caching)

Next.jsëŠ” ëŒ€ë¶€ë¶„ì˜ ì˜ì—­ì—ì„œ fetchí•¨ìˆ˜ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìºì‹±ì„ í•œë‹¤.
Next.jsì˜ fetch APIë¥¼ ê¸°ë°˜ìœ¼ë¡œ Next.jsì—ì„œ í™•ì¥í•œ ìƒˆë¡œìš´ fetch APIì´ê¸° ë–„ë¬¸ì´ë‹¤.

1. ì •ì í˜ì´ì§€ì¼ë•Œ
   (fetch optionì´ë‚˜ cache:force-cache)

- buildì‹œ ìš”ì²­ì‹œ ìºì‹±ì„ ì§„í–‰í•¨

2. Data Cache

- fetchí•¨ìˆ˜ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë°ì´í„°ë¥¼ ìºì‹±í•œë‹¤.
- ë™ì ë¼ìš°íŒ…ì¼ ë•Œ íŠ¹ì • fetchë§Œ caching ì‚¬ìš©
  cache: "no-store"

server-actions.ts ì„¤ì •

```js
// server-action.ts
export async function rePath() {
  revalidatePath("/");
}

export async function reTag() {
  revalidateTag("products");
}
```

---

## Parellel & Intercepting Routes

1. Parellel Routes

- ë™ì¼í•œ ë ˆì´ì•„ì›ƒ ë‚´ì—ì„œ ì—¬ëŸ¬ í˜ì´ì§€ë¥¼ ë™ì‹œì— ë˜ëŠ” ì¡°ê±´ë¶€ë¡œ ë Œë”ë§í•  ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤. ëŒ€ì‹œë³´ë“œë‚˜ ì†Œì…œ ì‚¬ì´íŠ¸ì˜ í”¼ë“œì™€ ê°™ì€ ë™ì ì¸ ì„¹ì…˜ì— ìœ ìš©í•˜ë‹¤.

2. Intercepting Routes

- ì‚¬ìš©ìê°€ í˜ì´ì§€ë¥¼ ì´ë™í•˜ì§€ ì•Šê³ ë„ íŠ¹ì • ì»¨í…ì¸ ë¥¼ ì˜¤ë²„ë ˆì´ë¡œ í‘œì‹œí•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ë¼ìš°íŒ… ë°©ì‹, ì˜ˆìŠ¬ ë“¤ì–´ì„œ, ã…ë“œã…”ì„œ ì‚¬ì§„ì„ í´ë¦­í•˜ë©´ í•´ë‹¹ ìƒí’ˆ ì‚¬ì§„ì´ ëª¨ë‹¬ë¡œ í‘œì‹œëœë‹¤. í•˜ì§€ë§Œ URLì„ ì§ì ‘ ì…ë ¥í•˜ê±°ë‚˜ í˜ì´ì§€ë¥¼ ìƒˆë¡œ ê³ ì¹¨í•  ë•ŒëŠ” ì „ì²´ í˜ì´ì§€ê¸° ë‹¤ì‹œ ë Œë”ë§ëœë‹¤. ì¦‰ ì†Œí”„íŠ¸ ë„¤ë¹„ê²Œì´ì…˜ì„ í•  ë•Œì—ë§Œ íŠ¹ì • ë¼ìš°íŠ¸ë¥¼ ê°€ë¡œì±„ì„œ ë‹¤ë¥¸ UIë¥¼ ë³´ì—¬ì¤€ë‹¤. ë³´í¸ì ìœ¼ë¡œëŠ” Parellel Routeì™€ í•¨ê»˜ ì‚¬ìš©ë˜ëŠ” ê³ ê¸‰ ë¼ìš°íŒ… ê¸°ë²•ì´ë‹¤.

### ë¼ìš°íŒ… ê·œì¹™

- **(.)**: ë™ì¼í•œ ë ˆë²¨ì˜ ì„¸ê·¸ë¨¼íŠ¸ì™€ ë§¤ì¹­
- **(..)**: í•œ ë ˆë²¨ ìœ„ì˜ ì„¸ê·¸ë¨¼íŠ¸ì™€ ë§¤ì¹­
- **(..)(..)**: ë‘ ë ˆë²¨ ìœ„ì˜ ì„¸ê·¸ë¨¼íŠ¸ì™€ ë§¤ì¹­
- **(...)**: ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì—ì„œ ì‹œì‘í•˜ëŠ” ëª¨ë“  ì„¸ê·¸ë¨¼íŠ¸ì™€ ë§¤ì¹­

```js
import { Product } from "@/type/product";
import Image from "next/image";

type Props = {
  params: {
    id: string,
  },
};

const ProductModal = async ({ params }: Props) => {
  const id = parseInt(params.id, 10);
  const res = await fetch(`http:localhost:4000/products/${id}`, {
    cache: "no-store",
  });
  const data: Product = await res.json();

  return (
    <div className="fixed rounded-md text-black bg-white/90 top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[300px] h-[300px]">
      <div className="flex flex-col p-5 gap-2 items-center">
        <Image
          src={data.images}
          alt={data.title}
          width={100}
          height={100}
          className="w-[100px] h-[100px] object-cover"
        ></Image>
        <div className="text-lg font-bold ">{data.title}</div>
        <div className="line-clamp-3">{data.description}</div>
        <button className="bg-gray-800 text-white px-4 py-2 rounded-md">
          View Detail
        </button>
      </div>
    </div>
  );
};

export default ProductModal;
```
